# AGENTS.md

本文件用于约束 `F:\ICT` 仓库内的协作规范与实现边界，作用域为当前目录及其所有子目录。

## 项目目标

- 参考 `https://github.com/Vespa314/chan.py`，实现前端 JS/TS 版本的缠论计算与可视化。
- 技术栈：`Bun + TypeScript + Vite + Vue 3 + KLineChart`。
- 行情来源仅支持两种：
  1. 币安 API（USDT 永续合约）
  2. 本地 CSV 导入

## 阶段边界（MVP）

- 先实现可运行、可观测、可扩展的最小版本：
  - K 线展示
  - 两种行情输入
  - `chan-core` 的基础结构与首批可迁移能力（分型/笔等骨架）
- 暂不实现交易下单、账户管理、策略回测引擎、机器学习能力。
- 暂不要求完整单元测试覆盖（可做最小运行验证与手动验证）。

## 架构约定

- 使用分层目录：
  - `src/core/chan`：缠论核心计算（纯函数、无 DOM 依赖）
  - `src/data`：行情适配层（binance/csv）
  - `src/components`：UI 组件
  - `src/views`：页面级编排
  - `src/workers`：耗时计算任务（后续迁移到 Web Worker）
- 核心算法不得直接依赖 Vue 实例或浏览器 DOM。
- 统一数据结构（KLine）作为跨层协议，避免各层重复定义。

## 代码规范

- 默认使用 TypeScript 严格模式。
- 避免 `any`；确需使用时必须局部、可解释。
- 命名以可读性优先，禁止单字母变量（循环计数器除外）。
- 不添加无意义注释；仅在复杂算法处写必要说明。
- 不引入与当前目标无关的库。

## 数据与时区约定

- K 线时间戳统一使用毫秒（`number`），语义为 UTC Unix ms。
- 前端展示时可本地化，但计算层统一 UTC 语义。
- CSV 导入需兼容常见列：`time/open/high/low/close/volume`（大小写不敏感）。

## 币安接口约定

- 市场：`fapi`（USDT 永续合约）。
- 默认端点：`/fapi/v1/klines`。
- 参数至少支持：`symbol`、`interval`、`limit`、`startTime`、`endTime`。
- 遵守请求频率限制，UI 层需提示错误与重试建议。

## KLineChart 集成约定

- 图表实例创建与销毁必须在组件生命周期中成对出现。
- 历史数据先整批加载，再支持增量更新。
- 缠论图形标注（笔/线段/中枢）以 overlay 插件方式组织，避免与基础蜡烛逻辑耦合。

## 迁移策略（从 chan.py 到 TS）

- 采用“功能切片”迁移，不做一次性全量翻译。
- 每迁移一个模块，都先完成：
  1. 类型定义
  2. 纯函数实现
  3. 在页面可视化验证
- Python 代码中的状态机逻辑优先保留语义，再做 TS 风格重构。

## 提交流程

- 变更应小步提交（逻辑上分块）。
- 每次改动后至少保证：
  - 项目可启动
  - 核心路径（加载行情 + 渲染 K 线）可用
- 若发现与本文件冲突的需求，以用户最新明确指令为准。

